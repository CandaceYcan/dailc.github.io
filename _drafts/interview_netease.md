# 网易考拉海购面试记

## 一面

标准的自我介绍（稍微注意了下描述，尽量从更高层次）

- 介绍quickhybrid介绍

大概介绍下：API，核心交互，以及技术迭代过程，然后继续问技术选型问题
（这点结合以前的从HTML5+转过来的经验写，大概是5+不符合需求，然后自己重新研发），
然后着重介绍了下原生和h5交互原理
（这里顺带提了下前端API做了多平台支撑工作），
然后聊了下人员分工（三人协作完成-自己负责规划），以及遇到的问题（技术迭代，从零开始）

- 介绍传统项目型前端框架

先介绍前因（因为特殊原因，无法用vue和react），
然后大概说了下自己调研过vue和weex，
以及尝试说服推动技术选型，但失败
（这里失败原因归了几类：自我原因，深度不过，介绍不够简洁，说服力不够，领导原因，思路守旧，其它人员原因，技术能力低下），
然后大概说了下应用场景：项目驱动型

问了下项目开发的协作过程：前后端分离，mock 系统，restfulAPI调试等等，
以及制定规范，整理方案，提高效率，以及沟通损耗无法避免的原因等等

然后就问了一些很基础很基础的题目，如

- 类jq的selector（介绍原生的document.querySelector）

- 轮播图的原理（css transform动画，
同时介绍了下多轮播图的链表优化，
以及一些细节，如阈值的控制，大于阈值则滑动，否则回弹，
再介绍了下防抖-记录当前时间，下一次执行-上次记录大于空闲才允许执行）


- 下拉刷新，完全自我发挥

先介绍由touch,scroll,css动画，硬件加速几大块组成，
然后分享了下iOS下滑动的bug（回弹），
然后介绍了下css3动画做bounce，
然后重点主动引出了硬件加速，

并且成功的开始介绍硬件加速原理：（普通层和复合层的概念）

同时简单介绍了下浏览器渲染原理

最后介绍了下下拉刷新的迭代过程（贯穿前端生涯）


然后问了下es6，主动说了下promise，fetch，箭头函数等

被问了promise，先说自己封装过promise，再介绍下API，再介绍下原理（微任务和宏任务的区别），
然后说明了下promise的then可以返回promise，then会放入队列中，等待本轮任务循环完毕后执行（微任务），
也提了下poll fill与官方的区别（微任务与宏任务）

然后成功的引到了微任务和宏任务：于是自己结合JS事件循环机制，微任务，宏任务简单介绍了下，
稍微提了下多线程控制，以及说微任务宏任务是由一篇国外文章中提到的（但是经过搜索引擎得到验证，类似于公认的叫法）

后来其实感觉自己可以进一步说明：task与job queues的（只是当时没反应过来）

总体感觉，js的稍微原理层面的都是自己主动抛出的

- css相关

先说了个当前页面重构机制（说px，一般最多兼容到rem与@media）

然后介绍了下rem，以及rem结合响应式，不同分辨率不同大小的处理

然后被问到了一个：drt

这个概念不知道是什么意思，后来解释了下：逻辑分辨率和物理分辨率

于是引到了viewport上，稍微介绍了下当前是标准的viewPort:device-width方案，
也提了下淘宝的viewport 33%，（问到了为什么？主动避过了-转到了下面的可能缺陷分析，后续可以查下）
以及提到了可能的缺陷：譬如1px像素问题（因为css像素实际的物理像素会更多，造成更宽）

然后小哥觉得时间差不多了（>1h），就结束了

问了下技术栈：

- 部分老项目-传统jq型（历史包袱很重）

- 部分部门内的mvvm-这部分需要重构优化成业界流行方案（有历史包袱）

- 还有部分面向部门内部的，技术选型方便（业界主流）

然后说内部去向只能由老大决定。。。

## 二面

二面是一个加面（正常应该是去杭州现场的，不过因为现实原因，无法去现场，于是hr提出加面要求）

总体来说，二面暴露了几个问题：

沟通方面，就是面试官问了几个问题，都没有理解清楚，答成另一个方向了。。。
（所以后续遇到不清楚的题目要详细的咨询下，避免答非所问，尽量往面试官预期上靠）

同样，回答问题时，有几个点回答的并不是面试官想要的。。。
（同样，这点后续尽量回答前谨慎咨询下，大概问清楚意图）

少用**大概**这个词汇

流程：

- 先开始仍然是自我介绍（介绍了大致的发展，以及在当前公司的主要成果，hybrid框架以及移动前端框架）

然后就是继续介绍hybrid框架，说了下大概几部分（jsbridge，组件，API规范等）

然后问了下原始和js端的交互（提到了JSCore），然后被问了一个问题，没答上：

- webview加载页面时，JSBridge对象何时注入的（处于页面解析的那一个阶段）？
回答是没有仔细研究过，不过后续会研究下（给了一个思路就是先确定当前是属于那一个阶段，然后再考虑优化，稍微提了下js线程）

其它的稍微提了下前端的库部分，包括多平台支持，以及用gulp，es6等开发打包等


- 然后是移动前端框架

先介绍了下大概：工具类，组件，简单的gulp构建等

然后问了下为何要推：回答是公司不允许react与vue

为何不允许？因为自己当初进行技术评估演示时被否决了，然后分析了下原因：

- 这个公司的前端人员基础较弱（jsp转过来的，只会jq，连node.js都没见过）

- 让领导觉得开发模式和以前差别较大（譬如由传统页面变成了组件化，工程化开发）

- 面试官后来提到一点（可能是页面较为简单，不是很复杂，导致简单模式也能用的过去）

然后问了下，如果再回去，应该如何推：

- 突出Vue的优势，mvvm双向绑定，减少dom操作提高性能以及减少大量的面条式代码，提高效率便于维护

- 然后，推的时候尽量先采用页面+js的形式引入vue，这样看起来开发模式更接近以前，变动较少

- 然后后续转vue后再考虑引入工程化，这样成功率会更高（总体这个答案应该还是可以的）

然后问了下为何用document.write写入脚本（这点应该没有答到面试官想要的答案，说了其它方面）

```js
为何用document.write写入框架脚本(在当前位置后写入内容)

其实主要作用是，document.write是同步的，它的作用是相当于直接在浏览器中script或link引入脚本与样式，
而且由于是框架代码，会有很多文件，所以要document.write写入，而且它写入还可控制缓存

不过，仅仅是在加载中可以这样使用，如果是页面加载完毕再使用，是不建议的。
如果在onload或DOMContentLoaded后在使用，会替换整个页面，所以慎用。。。
会清空文档（自动调用document.open()），再把参数写入body内容的开头。
```

所以，如果是document.write，write后仍然会继续解析，这样就相当于直接在HTML写入这个标签效果一样

然后问了下移动框架中组件开发的一些规范问题：

- 说了下组件的API规范，示例等等，但是没有说全

- 其实可以从代码规范，文档规范，调用方式，参数约束等多个角度入手

然后被问了下loadjs的内部实现

具体的细节忘了，不过说了动态添加标签，同步加载，异步加载控制，以及通过状态判断是否完成等等

提了下css加载方面的bug，不一定能监测到

而且被问了一个问题，一直没有达到他想要的点：脚本的onload时候，脚本内的内容有没有执行完毕（其实可以直接回答脚本执行完毕后再触发的onload的）


然后问了下css动画加速，这里直接回答了：硬件加速触发复合图层，提了下复合图层和普通图层的区别（单独绘制，这样性能更高），
不过也顺便提了下性能瓶颈（因为每一个复合图层都要分配资源，过多的话就会非常卡，这里提了下隐式合成的概念）

然后问了下js动画优化，首先提了下最好现设成复合图层，这样避免回流，然后说了下尽量避免getcomputedstyle等需要回流的操作。

最后，在面试官的提示下（因为真的现场一时想不起来），提到了requestAnimationFrame这个概念，它确保在下一次重绘之前触发，最大性能的优化动画。

当然提了下从setinternal到settimeout模拟（事件队列机制），再到requestAnimationFrame等等

总的来说，主要问题是：

1. 和面试官沟通时可能不是很到位（后续可以注意下沟通问题，仔细听，有问题先请询问，确认后再回答）

2. 有些地方没有答到面试官想要的（一样，可以先询问，或仔细意见，尽量往他想要的靠）

再次记录问题：

1. 面试官问问题一定要听清楚描述，不要太快回答，要逻辑严谨

2. 回答问题时不要答非所问（尽量往面试官预期去）

以及需要分析：

jsbridge的加载顺序-是什么时候加载的，在onload前还是onload后？得研究。

答案：这点Android和iOS要分开

1. 如果是Android中，Android使用的是window.prompt来作为交互桥梁，这个是webview自带的，相当于是BOM对象，所以不存在注入这一步，
页面加载完毕后就可调用（当然前提是页面自己已经加载了前端库），
当前在这之前，原生在webview加载的时候就已经将各大API的方法注册到内存中了。（在onActivityCreated时）

2. iOS中，也是在viewDidLoad时即那个API注册到内存中的（可以理解为浏览器初始化BOM的时期，很早），
然后JSBridge对象的注入时机是在viewDidLoad时就注入了WKWebViewJavascriptBridge
（时间点也是类似于初始化BOM时）

所以总结是，在浏览器端JS可用时，原生就已经将对象注入进去了

而且，在wkwebview中，哪怕reload页面之后，仍然是能获取JSCore对象的，而且哪怕href重定向后也没问题。

官方说明：viewDidLoad是在视图已经被加载后调用（而且每次重定向后都会加载）

所以哪个bug看起来更像是注入到JS时，某些脚本执行出问题了，导致没有注入生效？
这个有待分析。。。

## 三面（视频面试）

首先，严重怀疑这次是一个压力面试，体验不是很好。（总共时长40min左右）

首先说下自我感觉：就是感觉问的问题都是描述不是很清晰的那种，沟通起来比较费劲，而且比较有压迫感，
并不是自己期待的那种面试（预设是宏观上可以往架构谈，细节里可以往底层挖，但是这次更多都是一些业务描述，
而且沟通不是很顺畅）

大概问了这么多问题：（有些估计忘了）

- 对前端模版的理解（沟通不是很顺畅）

- 如何在一个jq项目中重构并引进mvvm模式

- 谈谈为何要用mvvm而不是jq（紧接上面）

- bind的理解（口头上描述如何实现）

- 单例模式的理解（口头上描述如何实现）

- 问了下如何实现一个弹窗

- 最后问了下移动前端的css了解程度（自己说了下实践不是很多但是理论还行，经常会作为技术支撑的，然后就没问了。。。）

- 然后问有什么问题要问的（问了两个）

__对前端模版的理解__

先谈了谈自己对前端页面模版的封装理解（就是页面模版提供，然后业务遇到需求自己修改模版），

然后说不是这样的（没答到他想要的？）

然后提示了下vue，然后我就继续说vue中的模版，包括template与style以及script构成组件，
以及mvvm中model数据和视图的绑定（视图中可能会用到{{}}这种模版），顺便解释了下mvvm原理

然后好像还不是想要的，于是又问了如何选择模版引擎（直接描述不久可以了。。。），大概说了下
mustache和handlebar的选择，一个轻量级，移动端，性能一般，一个重量级，pc端，性能较高，
然后说了下一般业务要求不高，直接内置handlebar

又问了下用到什么程度（回答就用到了模版映射，列表循环之类的，可能if，else都没用到）

然后准备说原理是正则解析时就被打断了。。。

总体感觉就是沟通起来很费劲，而且面试官很压迫（不像其它面试官那样彬彬有礼）

__如何在一个jq项目中重构并引进mvvm模式__

大概谈了下自己的理解。主要分别讲了下jq模式下的缺点，以及mvvm下的优点（从代码性能，冗余度，可维护性方面考虑）

然后谈了下如果jq项目中新模块用mvvm，得小心，如果不涉及组件，可以直接使用mvvm，如果涉及到组件，最好重构成vue规范的

当然，说了下，其实不少组件内部仍然是使用原生dom操作的，只不过是API层面更符合vue

这里又问了下vue中是否可以用jq那种组件（当然可以），然后问了下那一个生命周期后才能使用（mouted之后dom才加载完毕）

__bind的理解__

口头描述了下下述代码（利用context以及apply）

```js
Function.prototype.bind = function(context) {
    var self = this;
    
    return function() {
        self.apply(context, arguments);
    };
};
```

__单例模式的理解__

口头描述了下下述代码（觉得过于简单，于是说了下最开始java中用到过）

```js
(function() {
    var instance;
    
    function Dialog() {
        ...
    }
    
    Dialog.create = function() {
        if (!instance) {
            instance = new Dialog();
        }
        
        return instance;
    };
})();
```

__问了下如何实现一个弹窗__

其实就是最简单的css+html布局构成一个dialog而已。。。沟通不是很好

其实只要样式布局+html负责结构就可以了

__最后问了下移动前端的css了解程度__

说了下，自己重构实践不多，但是解决过很多问题，一些优化方面的知识都知道。然后就没问了。。。


__然后问有什么问题要问的__

1. 感觉这次面试发挥不好，请问有什么建议（个人感觉沟通起来不顺，体验不好）

回答是：还不错啊，问到的都回答上了。。。

2. 未来过去后技术栈

回答是：后续会转vue

总体来说，我个人猜测可能是压力面试（否则的话这么差的体验优点说不过去）

另外，由于是视频面试，刚好舍友也听到了后版本分，他们觉得面试官不太礼貌，不尊重人，而且问的知识没营养。。。
（大概就是问题很模糊，然后有点不耐烦，很压迫）

不过我个人目前仍然倾向是压力面试。。。（先以好意来揣测）

选模版引擎的一个关键性因素是速度

handlebars:（30k）

- 能强大，但是比较重，如果项目颇大，对模版有较强的要求又不想用 ng 等框架的话，可以考虑

- 另一个特点是兼容 Mustache 语法，多数情况下可以直接迁移

- 虽然大，但是速度很快

mustache:（5k）

- 相对来说，较为轻量级

为什么用模版渲染引擎：

1. 不用再拼接字符串了，比如以前拼接字符串时性能是很低的（得重复生成新的字符串），
而且字符串的拼接代码可维护性非常低

2. 在需要根据不同数据，重复生成结构相同的html时候，模板可以大大节省你的代码量，以及提高可维护性。

3. 一般考虑的因素是：可维护性，可扩展性，开发效率提高，以及性能

特别是面对复杂的业务逻辑，分层清晰的代码的可读性，可维护性会好得多

https://www.zhihu.com/question/32524504

严格的模板引擎的定义，输入模板字符串 + 数据，得到渲染过的字符串。

## 被拒

总体来说，还是很难受。

目前理智分析下来，自己原因有可能是：

- 和他沟通起来时不顺畅，先不管他提出问题是模糊不模糊，但是，作为一个合格的程序员，遇到需求不清时，
应该先了解需求，先明白理解需求后在作答，而不是仓促作答

- 可能一些语言的描述的组织下，让自己口齿更清晰点

